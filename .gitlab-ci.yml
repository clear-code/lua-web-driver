stages:
  - test
  - deploy

variables:
  GECKODRIVER_VERSION: "0.21.0"

test-centos7:
  image: centos:7
  stage: test
  before_script:
    - yum install -q -y epel-release
    - yum install -q -y gcc gcc-c++ git lua-devel luajit luajit-devel luarocks make m4 openssl-devel firefox ruby
    - curl -L -O https://github.com/mozilla/geckodriver/releases/download/v${GECKODRIVER_VERSION}/geckodriver-v${GECKODRIVER_VERSION}-linux64.tar.gz
    - tar xf geckodriver-v${GECKODRIVER_VERSION}-linux64.tar.gz -C /usr/local/bin
    - chmod +x /usr/local/bin/geckodriver
    - ls -l /usr/local/bin/geckodriver
    - geckodriver --version
    - ruby -v
    - luarocks install lua-requests
    - luarocks install luautf8
    - luarocks install process
    - luarocks install lbase64
    - luarocks install luaunit
    - luarocks install inspect
    - luarocks install lua-log
  script:
    - luajit test/run-test.lua -v

pages:
  image: centos:7
  stage: deploy
  before_script:
    - cd docs
    - bundle install
  script:
    - bundle exec jekyll build -d ../public
  artifacts:
    paths:
      - public
  only:
    - master
